version: '3.9'
services:
  prowlarr:
    image: lscr.io/linuxserver/prowlarr:2.0.4-nightly
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
    volumes:
      - /home/matt/prowlarr:/config
    ports:
      - 9696:9696
    restart: unless-stopped

  readarr:
    image: lscr.io/linuxserver/readarr:0.4.19-nightly
    container_name: readarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
    volumes:
      - /home/matt/readarr:/config
      - books:/books
      - nzb-dls:/downloads
    ports:
      - 8787:8787
    restart: unless-stopped

  mylar3:
    image: lscr.io/linuxserver/mylar3:latest
    container_name: mylar3
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
    volumes:
      - /home/matt/mylar3/:/config
      - comics:/comics
      - torrent-dls:/downloads
    ports:
      - 8090:8090
    restart: unless-stopped

  openaudible:
    image: openaudible/openaudible:latest
    container_name: openaudible
    ports:
      - 13380:80
      - 3033:3000
    volumes:
      - audiobook-uploads:/uploads
      - /home/matt/oa-matt:/config
    restart: unless-stopped

  nordlynx:
    image: ghcr.io/bubuntux/nordlynx:2025-05-01
    container_name: nordlynx
    cap_add:
      - NET_ADMIN                             # required
      - SYS_MODULE                            # maybe
    environment:
      - PRIVATE_KEY=${NORDLYNX_KEY}
      - QUERY=filters\[servers_groups\]\[identifier\]=legacy_p2p
      - NET_LOCAL=192.168.0.0/16
      - TZ=America/Chicago
    ports:
      - 8089:8089 # qbittorrent web interface
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
      - net.ipv4.conf.all.rp_filter=2
      - net.ipv6.conf.all.disable_ipv6=1
    restart: unless-stopped

  qbittorrent:
    image: linuxserver/qbittorrent:20.04.1
    network_mode: service:nordlynx
    container_name: qbittorrent
    depends_on:
      - nordlynx
    environment:
      - WEBUI_PORT=8089
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - NETWORK=192.168.1.0/24  # So it can be accessed within the local network
        #ports:
        #- 8089:8089
    volumes:
      - /home/matt/qbittorrent:/config
      - torrent-dls:/downloads
    restart: unless-stopped

  qbittorrentnovpn:
    image: lscr.io/linuxserver/qbittorrent:20.04.1
    container_name: qbittorrentnovpn
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - WEBUI_PORT=8484
      - TORRENTING_PORT=6881
    volumes:
      - /home/matt/qbittorrentnovpn:/config
      - torrent-dls:/downloads
    ports:
      - 8484:8484
      - 6881:6881
      - 6881:6881/udp
    restart: unless-stopped

  handbrake:
    image: jlesage/handbrake:v25.07.2
    container_name: handbrake
    ports:
      - 5800:5800
    volumes:
      - /home/matt/handbrake:/config
      - handbrake:/storage 
      - handbrake:/watch
      - handbrake:/output
    restart: unless-stopped

  homebridge:
    image: homebridge/homebridge:2024-12-11
    container_name: homebridge
    network_mode: host
    volumes:
      - /home/matt/homebridge:/homebridge
    logging:
      driver: json-file
      options:
        max-size: '10m'
        max-file: '1'
    healthcheck:
      test: curl --fail localhost:8581 || exit 1
      interval: 60s
      retries: 5
      start_period: 300s
      timeout: 2s
    restart: unless-stopped

  homeassistant:
    container_name: homeassistant
    image: ghcr.io/home-assistant/home-assistant:2025.8.1
    volumes:
      - /home/matt/homeassistant:/config
      - /etc/localtime:/etc/localtime:ro
      - /run/dbus:/run/dbus:ro
    network_mode: host
    restart: unless-stopped

  calibre:
    image: ghcr.io/linuxserver/calibre:8.8.0
    container_name: calibre
    environment:
      - PUID=1000
      - PGID=1000
    volumes:
      - /home/matt/calibre:/config
      - book-uploads:/uploads
      - book-plugins:/plugins
    ports:
      - 8383:8080
      - 8283:8081
    restart: unless-stopped

  calibre-web:
    image: lscr.io/linuxserver/calibre-web:0.6.24
    container_name: calibre-web
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Chicago
      - DOCKER_MODS=linuxserver/mods:universal-calibre #optional
      - OAUTHLIB_RELAX_TOKEN_SCOPE=1 #optional
    volumes:
      - /home/matt/calibre:/config
      - books:/books
    ports:
      - 8083:8083
    restart: unless-stopped

  mysql:
    image: mysql:9.4
    container_name: mysql
    hostname: mysql
    restart: unless-stopped
    volumes:
      - /home/matt/semaphore-mysql:/var/lib/mysql
    environment:
      MYSQL_RANDOM_ROOT_PASSWORD: 'yes'
      MYSQL_DATABASE: semaphore
      MYSQL_USER: semaphore
      MYSQL_PASSWORD: ${MYSQL_PASSWORD}

  semaphore:
    image: semaphoreui/semaphore:v2.15.0
    container_name: semaphore
    restart: unless-stopped
    ports:
      - 3333:3000
    environment:
      SEMAPHORE_DB_USER: semaphore
      SEMAPHORE_DB_PASS: ${MYSQL_PASSWORD}
      SEMAPHORE_DB_HOST: mysql
      SEMAPHORE_DB_PORT: 3306
      SEMAPHORE_DB_DIALECT: mysql
      SEMAPHORE_DB: semaphore
      SEMAPHORE_PLAYBOOK_PATH: /tmp/semaphore/
      SEMAPHORE_ADMIN_PASSWORD: ${SEMAPHORE_ADMIN_PASSWORD}
      SEMAPHORE_ADMIN_NAME: admin
      SEMAPHORE_ADMIN_EMAIL: admin@localhost
      SEMAPHORE_ADMIN: admin
      SEMAPHORE_ACCESS_KEY_ENCRYPTION: ${SEMAPHORE_ACCESS_KEY_ENCRYPTION}
    depends_on:
      - mysql
  
  diun:
    image: crazymax/diun:4.29
    container_name: diun
    command: serve
    volumes:
      - "/home/matt/diun:/data"
      - "/var/run/docker.sock:/var/run/docker.sock"
    environment:
      - "TZ=America/Chicago"
      - "LOG_LEVEL=info"
      - "LOG_JSON=false"
      - "DIUN_WATCH_WORKERS=20"
      - "DIUN_WATCH_SCHEDULE=0 20 * * 0"
      - "DIUN_WATCH_JITTER=30s"
      - "DIUN_PROVIDERS_DOCKER=true"
      - "DIUN_PROVIDERS_DOCKER_WATCHBYDEFAULT=true"
      - "DIUN_NOTIF_PUSHOVER_TOKEN=${PUSHOVER_TOKEN}"
      - "DIUN_NOTIF_PUSHOVER_RECIPIENT=${PUSHOVER_RECIPIENT}"
    restart: always

  broker:
    image: docker.io/library/redis:7
    container_name: paperless-redis
    restart: unless-stopped
    volumes:
      - /home/matt/redis:/data

  db:
    image: docker.io/library/postgres:15
    container_name: paperless-postgres    
    restart: unless-stopped
    volumes:
      - /home/matt/postgres:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: paperless
      POSTGRES_USER: paperless
      POSTGRES_PASSWORD: paperless

  webserver:
    image: ghcr.io/paperless-ngx/paperless-ngx:2.17.1
    container_name: paperless-ngx
    restart: unless-stopped
    depends_on:
      - db
      - broker
      - gotenberg
      - tika
    ports:
      - "8000:8000"
    volumes:
      - /home/matt/paperless/data:/usr/src/paperless/data
      - /home/matt/paperless/media:/usr/src/paperless/media
      - ./export:/usr/src/paperless/export
      - ./consume:/usr/src/paperless/consume
    labels:
      - traefik.enable=true
      - traefik.http.routers.paperless.rule=Host(`paperless.tehmatt.com`)
      - traefik.http.routers.paperless.entrypoints=websecure
      - traefik.http.routers.paperless.tls.certresolver=letsencrypt
    environment:
      PAPERLESS_REDIS: redis://broker:6379
      PAPERLESS_DBHOST: db
      PAPERLESS_TIKA_ENABLED: 1
      PAPERLESS_TIKA_GOTENBERG_ENDPOINT: http://gotenberg:3000
      PAPERLESS_TIKA_ENDPOINT: http://tika:9998
      PAPERLESS_ADMIN_USER: ${PAPERLESS_ADMIN_USER}
      PAPERLESS_ADMIN_PASSWORD: ${PAPERLESS_ADMIN_PASSWORD}
      PAPERLESS_URL: ${PAPERLESS_URL}

  gotenberg:
    image: docker.io/gotenberg/gotenberg:7.10
    container_name: paperless-gotenberg
    restart: unless-stopped

    # The gotenberg chromium route is used to convert .eml files. We do not
    # want to allow external content like tracking pixels or even javascript.
    command:
      - "gotenberg"
      - "--chromium-disable-javascript=true"
      - "--chromium-allow-list=file:///tmp/.*"

  tika:
    image: ghcr.io/paperless-ngx/tika:latest
    container_name: paperless-tika
    restart: unless-stopped

  uptimekuma:
    image: docker.io/louislam/uptime-kuma:1.23.16
    container_name: uptimekuma
    ports:
      - 3001:3001
    volumes:
      - /home/matt/uptimekuma:/app/data
    restart: unless-stopped

  starcraft:
    image: docker.io/ageo24/sc-bw-vnc:1.0
    container_name: starcraft
    ports:
      - 7070:8080
    restart: unless-stopped

  mattodo-api:
    image: ghcr.io/mtstrong/mattodo.api:v1.0.5
    container_name: mattodo-api
    ports:
      - 7260:7260
    volumes:
      - /home/matt/mattodo-api:/config
    restart: unless-stopped

  ddclient:
    image: lscr.io/linuxserver/ddclient:latest
    container_name: ddclient
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
    volumes:
      - /home/matt/ddclient:/config
    restart: unless-stopped

  tinyauth:
    container_name: tinyauth
    image: ghcr.io/steveiliop56/tinyauth:v3
    environment:
      - SECRET=${TINYAUTH_SECRET}
      - APP_URL=https://tinyauth.tehmatt.com
      - LOG_LEVEL=0
      - USERS=${USERS}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
      - OAUTH_WHITELIST=swevo24@gmail.com,myswtghst@gmail.com,leslie.r.strong@gmail.com
    restart: unless-stopped

  checkmk:
    image: checkmk/check-mk-raw:2.4.0-latest
    container_name: checkmk-server
    ports:
      - "5000:5000"
      - "5001:5001"
      - "6556:6556"
    volumes:
      - /home/matt/checkmk:/omd/sites
    restart: unless-stopped

  omni-tools:
    image: iib0011/omni-tools:0.5.0
    container_name: omni-tools
    ports:
      - "8384:80"
    restart: unless-stopped

  dozzle:
    container_name: dozzle
    image: amir20/dozzle:v8
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "8385:8080"
    restart: unless-stopped
    
  ollama:
    image: ollama/ollama:0.9.6
    container_name: ollama
    ports:
      - "11434:11434"
    volumes:
      - /home/matt/ollama:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    restart: always

  openwebui:
    image: ghcr.io/open-webui/open-webui:0.6.22
    container_name: open-webui
    ports:
      - "3008:8080"
    environment:
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
    extra_hosts:
      - host.docker.internal:host-gateway
    volumes:
      - /home/matt/open-webui:/app/backend/data
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
    labels:
      - traefik.enable=true
      - traefik.http.routers.openwebui.rule=Host(`ollama.tehmatt.com`)
      - traefik.http.routers.openwebui.entrypoints=websecure
      - traefik.http.routers.openwebui.tls.certresolver=letsencrypt
      #- traefik.http.routers.openwebui.middlewares=tinyauth
    restart: always
    
volumes: 
  semaphore-mysql:
  tv:
    external: true
  movies:
    external: true
  comics:
    external: true
  books:
    external: true
  book-uploads:
    external: true
  book-plugins:
    external: true
  nzb-dls:
    external: true
  torrent-dls:
    external: true
  b-dls:
    external: true
  audiobooks:
    external: true
  audiobook-uploads:
    external: true
  podcasts:
    external: true
  handbrake:
    external: true
  netboot:
    external: true